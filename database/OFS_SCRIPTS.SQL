CREATE USER OFS
IDENTIFIED BY OFS
DEFAULT TABLESPACE TS_OFS
TEMPORARY TABLESPACE TS_OFS_TMP
QUOTA UNLIMITED ON TS_OFS
QUOTA UNLIMITED ON TS_OFS_INDEX;

CREATE SEQUENCE OFS.SEQ_RESTAURANTS
START WITH 1
INCREMENT BY 1
MAXVALUE 99999999
CACHE 50
NOCYCLE;

CREATE SEQUENCE OFS.SEQ_RESTAURANT_CATEGORIES
START WITH 1
INCREMENT BY 1
MAXVALUE 99999999
CACHE 50
NOCYCLE;

CREATE SEQUENCE OFS.SEQ_MUNICIPALITIES
START WITH 1
INCREMENT BY 1
MAXVALUE 99999999
CACHE 50
NOCYCLE;

CREATE TABLE OFS.T_RESTAURANTS(
N_ID NUMBER(10,0) NOT NULL,
N_CATEGORY_ID NUMBER(10,0) NOT NULL,
N_MUNICIPALITY_ID NUMBER(10,0) NOT NULL,
V_NAME NVARCHAR2(50) NOT NULL,
V_COORDINATES NVARCHAR2(100) NOT NULL
) TABLESPACE TS_OFS;

CREATE TABLE OFS.T_RESTAURANT_CATEGORIES(
N_ID NUMBER(10,0) NOT NULL,
V_DESCRIPTION NVARCHAR2(50) NOT NULL
) TABLESPACE TS_OFS;

CREATE TABLE OFS.T_MUNICIPALITIES(
N_ID NUMBER(10,0) NOT NULL,
V_NAME NVARCHAR2(50) NOT NULL
) TABLESPACE TS_OFS;

ALTER TABLE OFS.T_RESTAURANTS ADD CONSTRAINT PK_RESTAURANTS PRIMARY KEY (N_ID) USING INDEX TABLESPACE TS_OFS_INDEX;
ALTER TABLE OFS.T_RESTAURANT_CATEGORIES ADD CONSTRAINT PK_RESTAURANT_CATEGORIES PRIMARY KEY (N_ID) USING INDEX TABLESPACE TS_OFS_INDEX;
ALTER TABLE OFS.T_MUNICIPALITIES ADD CONSTRAINT PK_MUNICIPALITIES PRIMARY KEY (N_ID) USING INDEX TABLESPACE TS_OFS_INDEX;

ALTER TABLE OFS.T_RESTAURANTS ADD CONSTRAINT FK_RESTAURANTS_CAT FOREIGN KEY (N_CATEGORY_ID) REFERENCES OFS.T_RESTAURANT_CATEGORIES (N_ID);
ALTER TABLE OFS.T_RESTAURANTS ADD CONSTRAINT FK_RESTAURANTS_MUN FOREIGN KEY (N_MUNICIPALITY_ID) REFERENCES OFS.T_MUNICIPALITIES (N_ID);

CREATE INDEX IDX_RESTAURANTS_CAT ON OFS.T_RESTAURANTS (N_CATEGORY_ID) TABLESPACE TS_OFS_INDEX;
CREATE INDEX IDX_RESTAURANTS_MUN ON OFS.T_RESTAURANTS (N_MUNICIPALITY_ID) TABLESPACE TS_OFS_INDEX;

CREATE OR REPLACE TRIGGER OFS.TRG_RESTAURANTS_BR
BEFORE INSERT ON OFS.T_RESTAURANTS
FOR EACH ROW
DECLARE
BEGIN
IF(:NEW.N_ID IS NULL)
THEN
:NEW.N_ID := OFS.SEQ_RESTAURANTS.NEXTVAL;
END IF;
END;
/

CREATE OR REPLACE TRIGGER OFS.TRG_RESTAURANT_CATEGORIES_BR
BEFORE INSERT ON OFS.T_RESTAURANT_CATEGORIES
FOR EACH ROW
DECLARE
BEGIN
IF(:NEW.N_ID IS NULL)
THEN
:NEW.N_ID := OFS.SEQ_RESTAURANT_CATEGORIES.NEXTVAL;
END IF;
END;
/

CREATE OR REPLACE TRIGGER OFS.TRG_MUNICIPALITIES_BR
BEFORE INSERT ON OFS.T_MUNICIPALITIES
FOR EACH ROW
DECLARE
BEGIN
IF(:NEW.N_ID IS NULL)
THEN
:NEW.N_ID := OFS.SEQ_MUNICIPALITIES.NEXTVAL;
END IF;
END;
/